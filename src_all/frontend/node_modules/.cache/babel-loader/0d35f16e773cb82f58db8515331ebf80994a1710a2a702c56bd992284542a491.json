{"ast":null,"code":"import { ref } from 'vue';\nimport axios from 'axios';\nimport { useRoute, useRouter } from 'vue-router';\nexport default {\n  name: \"DiaryDetail\",\n  setup() {\n    const route = useRoute();\n    const router = useRouter();\n    const diary = ref({}); // 存储日记详情\n\n    // 从路由参数中获取日记详情\n    const fetchDiaryDetail = async () => {\n      const diaryData = JSON.parse(route.query.diary);\n      diary.value = diaryData;\n      await updatePopularity(diary.value.content);\n    };\n\n    //更细日记热度\n    const updatePopularity = async diaryContent => {\n      try {\n        const response = await axios.post('/api/diary-popularity', {\n          content: diaryContent\n        });\n        if (response.data.success) {\n          // 假设后端返回新的热度值\n          diary.value.popularity = response.data.popularity;\n          console.log('热度更新成功');\n        } else {\n          console.error('更新热度失败:', response.data.message);\n        }\n      } catch (err) {\n        console.error('更新热度时发生错误:', err);\n      }\n    };\n\n    // 评分相关数据和方法\n    const ratingOptions = [0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5];\n    const currentRating = ref(null); // 当前选中的评分\n\n    const selectRating = rating => {\n      currentRating.value = rating;\n    };\n    const submitRating = async () => {\n      if (currentRating.value === null) {\n        console.error('请先选择一个分数');\n        return;\n      }\n      try {\n        const response = await axios.post('/api/diary-rating', {\n          content: diary.value.content,\n          rating: currentRating.value\n        });\n        if (response.data.success) {\n          alert('评分提交成功'); // 显示成功消息\n          console.log('评分提交成功');\n        } else {\n          console.error('评分提交失败:', response.data.message);\n        }\n      } catch (err) {\n        console.error('提交评分时发生错误:', err);\n      }\n    };\n\n    // 返回按钮\n    const goBack = () => {\n      router.go(-1); // 返回上一页\n    };\n\n    // 初始化获取日记详情\n    fetchDiaryDetail();\n    return {\n      diary,\n      goBack,\n      ratingOptions,\n      currentRating,\n      selectRating,\n      submitRating\n    };\n  }\n};","map":{"version":3,"names":["ref","axios","useRoute","useRouter","name","setup","route","router","diary","fetchDiaryDetail","diaryData","JSON","parse","query","value","updatePopularity","content","diaryContent","response","post","data","success","popularity","console","log","error","message","err","ratingOptions","currentRating","selectRating","rating","submitRating","alert","goBack","go"],"sources":["D:\\Users\\SevenGrass\\Documents\\WILLIAMZHANG\\DataStrucCourseDes\\MyGithub\\src_all\\frontend\\src\\components\\DiaryDetail.vue"],"sourcesContent":["<template>\r\n    <div class=\"background\"></div>\r\n    <form class=\"form\">\r\n        <div class=\"diary-detail\">\r\n            <h1>{{ diary.title }}</h1>\r\n            <p>作者：{{ diary.author }}</p>\r\n            <p>描述对象：{{ diary.description }}</p>\r\n            <p>内容：</p>\r\n            <div v-html=\"diary.content\"></div>\r\n            <p>热度：{{ diary.popularity }}</p>\r\n            <p>评分：{{ diary.rating }}</p>\r\n            <!-- 评分组件 -->\r\n            <div class=\"rating\">\r\n                <button\r\n                    v-for=\"rating in ratingOptions\"\r\n                    :key=\"rating\"\r\n                    @click.prevent=\"selectRating(rating)\"\r\n                    :class=\"{ 'selected': currentRating === rating }\"\r\n                >\r\n                    {{ rating }}\r\n                </button>\r\n            </div>\r\n            <button @click.prevent=\"submitRating\">提交评分</button>\r\n            <button @click.prevent=\"goBack\">返回</button>\r\n        </div>\r\n    </form>\r\n</template>\r\n\r\n<script>\r\nimport { ref } from 'vue';\r\nimport axios from 'axios';\r\nimport { useRoute, useRouter } from 'vue-router';\r\n\r\n\r\nexport default {\r\n    name: \"DiaryDetail\",\r\n\r\n    setup() {\r\n        const route = useRoute();\r\n        const router = useRouter();\r\n        const diary = ref({}); // 存储日记详情\r\n\r\n        // 从路由参数中获取日记详情\r\n        const fetchDiaryDetail = async () => {\r\n            const diaryData = JSON.parse(route.query.diary);\r\n            diary.value = diaryData;\r\n\r\n            await updatePopularity(diary.value.content);\r\n        };\r\n\r\n        //更细日记热度\r\n        const updatePopularity = async (diaryContent) => {\r\n            try {\r\n                const response = await axios.post('/api/diary-popularity', {\r\n                    content: diaryContent\r\n                });\r\n                if (response.data.success) {\r\n                    // 假设后端返回新的热度值\r\n                    diary.value.popularity = response.data.popularity;\r\n                    console.log('热度更新成功');\r\n                } else {\r\n                    console.error('更新热度失败:', response.data.message);\r\n                }\r\n            } catch (err) {\r\n                console.error('更新热度时发生错误:', err);\r\n            }\r\n        };\r\n\r\n        // 评分相关数据和方法\r\n        const ratingOptions = [0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5];\r\n        const currentRating = ref(null); // 当前选中的评分\r\n\r\n        const selectRating = (rating) => {\r\n            currentRating.value = rating;\r\n        };\r\n\r\n        const submitRating = async () => {\r\n            if (currentRating.value === null) {\r\n                console.error('请先选择一个分数');\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const response = await axios.post('/api/diary-rating', {\r\n                    content: diary.value.content,\r\n                    rating: currentRating.value,\r\n                });\r\n                if (response.data.success) {\r\n                    alert('评分提交成功'); // 显示成功消息\r\n                    console.log('评分提交成功');\r\n                } else {\r\n                    console.error('评分提交失败:', response.data.message);\r\n                }\r\n            } catch (err) {\r\n                console.error('提交评分时发生错误:', err);\r\n            }\r\n        };\r\n\r\n        // 返回按钮\r\n        const goBack = () => {\r\n            router.go(-1); // 返回上一页\r\n        };\r\n\r\n        // 初始化获取日记详情\r\n        fetchDiaryDetail();\r\n\r\n        return {\r\n            diary,\r\n            goBack,\r\n            ratingOptions,\r\n            currentRating,\r\n            selectRating,\r\n            submitRating,\r\n        };\r\n    },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.rating button {\r\n    margin: 0 5px;\r\n    padding: 5px 10px;\r\n    border: 1px solid #ddd;\r\n    background-color: #f8f8f8;\r\n    cursor: pointer;\r\n}\r\n\r\n.rating button.selected {\r\n    background-color: #e0e0e0;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}